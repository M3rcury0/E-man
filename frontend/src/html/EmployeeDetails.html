<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Employee Details</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../css/styles.css" />
  </head>
  <body>
    <div class="container mt-4">
      <div class="row">
        <div class="col-12">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>Employee Details</h2>
            <div class="text-end">
              <div class="mb-2">
                Current Date and Time (UTC): <span id="currentTime"></span>
              </div>
              <div>
                Current User's Login: <span id="currentUser">M3rcury0</span>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-body">
              <div id="employeeDetails" class="p-3">
                <!-- Employee details will be inserted here -->
                <div class="text-center">
                  <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                  <p>Loading employee details...</p>
                </div>
              </div>
            </div>
          </div>

          <div class="mt-3">
            <button
              onclick="window.location.href='EmployeeList.html'"
              class="btn btn-secondary"
            >
              Back to List
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Update current time
      function updateDateTime() {
        const now = new Date();
        const year = now.getUTCFullYear();
        const month = String(now.getUTCMonth() + 1).padStart(2, "0");
        const day = String(now.getUTCDate()).padStart(2, "0");
        const hours = String(now.getUTCHours()).padStart(2, "0");
        const minutes = String(now.getUTCMinutes()).padStart(2, "0");
        const seconds = String(now.getUTCSeconds()).padStart(2, "0");

        const formattedDateTime = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        document.getElementById("currentTime").textContent = formattedDateTime;
      }

      // Update time immediately and then every second
      updateDateTime();
      setInterval(updateDateTime, 1000);
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const urlParams = new URLSearchParams(window.location.search);
        const employeeId = urlParams.get("id");

        if (!employeeId) {
          showError("No employee ID provided");
          return;
        }

        console.log("Fetching employee with ID:", employeeId); // Debug log

        // Use the same endpoint as your list page
        fetch("http://localhost:8080/api/employees")
          .then((response) => {
            if (!response.ok) {
              throw new Error("Failed to fetch employees");
            }
            return response.json();
          })
          .then((employees) => {
            // Find the specific employee from the array
            const employee = employees.find(
              (emp) => emp.id === parseInt(employeeId)
            );

            if (!employee) {
              throw new Error("Employee not found");
            }

            console.log("Found employee:", employee); // Debug log

            const detailsHtml = `
                        <div class="row">
                            <div class="col-md-6">
                                <h4 class="mb-3">Employee Information</h4>
                                <table class="table">
                                    <tbody>
                                        <tr>
                                            <th scope="row">ID:</th>
                                            <td>${employee.id}</td>
                                        </tr>
                                        <tr>
                                            <th scope="row">Name:</th>
                                            <td>${employee.name}</td>
                                        </tr>
                                        <tr>
                                            <th scope="row">Age:</th>
                                            <td>${employee.age}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="col-md-6">
                                <h4 class="mb-3">Manager Information</h4>
                                <table class="table">
                                    <tbody>
                                        <tr>
                                            <th scope="row">Manager Name:</th>
                                            <td>${
                                              employee.managerName || "N/A"
                                            }</td>
                                        </tr>
                                        <tr>
                                            <th scope="row">Department:</th>
                                            <td>${
                                              employee.managerDepartment ||
                                              "N/A"
                                            }</td>
                                        </tr>
                                        <tr>
                                            <th scope="row">Manager ID:</th>
                                            <td>${
                                              employee.managerId || "N/A"
                                            }</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col">
                                <button onclick="window.location.href='EmployeeEdit.html?id=${
                                  employee.id
                                }'" class="btn btn-warning">Edit Employee</button>
                            </div>
                        </div>
                    `;
            document.getElementById("employeeDetails").innerHTML = detailsHtml;
          })
          .catch((error) => {
            console.error("Error:", error);
            showError("Error loading employee details: " + error.message);
          });
      });

      function showError(message) {
        document.getElementById("employeeDetails").innerHTML = `
                <div class="alert alert-danger" role="alert">
                    ${message}
                </div>
            `;
      }
    </script>
  </body>
</html>
